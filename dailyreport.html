<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🛠️ Report Bus Issue - TNSTC</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      animation: gradientShift 8s ease-in-out infinite alternate;
    }
    @keyframes gradientShift {
      0% { background: linear-gradient(135deg, #00c6ff, #0072ff); }
      100% { background: linear-gradient(135deg, #00b09b, #96c93d); }
    }

    .form-container {
      width: 100%;
      max-width: 450px;
      background: #ffffffcc;
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }
    .form-container:hover { transform: scale(1.02); }

    h1 { text-align: center; color: #007bff; margin-bottom: 10px; }
    h2 { text-align: center; color: #444; font-weight: 500; margin-bottom: 25px; }

    label { font-weight: 600; margin-bottom: 5px; display: block; color: #333; }
    input, select, textarea {
      width: 100%; padding: 12px 14px; margin-bottom: 15px;
      border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #007bff;
      box-shadow: 0 0 8px rgba(0,123,255,0.3);
      outline: none;
    }
    textarea { resize: none; }

    button {
      background: linear-gradient(135deg, #28a745, #218838);
      color: white; font-size: 16px; border: none; padding: 12px;
      border-radius: 12px; cursor: pointer; font-weight: 600; width: 100%;
      transition: all 0.3s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #218838, #1e7e34);
      transform: scale(1.03);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .popup {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: white; padding: 30px 40px;
      border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      text-align: center; opacity: 0; transition: all 0.3s ease; z-index: 10;
    }
    .popup.active { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    .popup h3 { color: #28a745; margin-bottom: 10px; }
    .popup p { color: #444; font-size: 15px; }

    @media (max-width:600px) { .form-container { padding:25px 20px; } }
  </style>
</head>
<body>

<div class="form-container">
  <h1>🛠️ Report Bus Issue</h1>
  <h2>பஸ் கோளாறு புகார்</h2>

  <form id="busIssueForm">
    <label for="busNumber">Bus Number / பஸ் எண்:</label>
    <input type="text" id="busNumber" name="busNumber" placeholder="Ex: TN-57 N-1234" required>

    <label for="issueType">Issue Type / கோளாறு வகை:</label>
    <select id="issueType" name="issueType" required>
      <option value="">-- Select --</option>
      <option value="engine">Engine / இயந்திரம்</option>
      <option value="ac">AC / குளிர்சாதன</option>
      <option value="brake">Brakes / பிரேக்</option>
      <option value="lights">Lights / விளக்குகள்</option>
      <option value="others">Others / மற்றவை</option>
    </select>

    <label for="description">Describe the problem / விளக்கம்:</label>
    <textarea id="description" name="description" rows="4" placeholder="Explain the issue clearly..." required></textarea>

    <button type="submit">📤 Submit Report / புகாரை சமர்ப்பிக்கவும்</button>
  </form>
</div>

<div id="popup" class="popup">
  <h3>✅ Report Submitted!</h3>
  <p>Your bus issue has been successfully recorded.</p>
</div>

<!-- Firebase v10 Modular SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD2Z9p3qb8Cj22ew0AzaRvfxm8i-J9XBO4",
    authDomain: "drivesafe-connect.firebaseapp.com",
    projectId: "drivesafe-connect",
    storageBucket: "drivesafe-connect.firebasestorage.app",
    messagingSenderId: "549149372493",
    appId: "1:549149372493:web:40572fbf76de8b3f1b6c04",
    measurementId: "G-GGFYN26XEH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const form = document.getElementById('busIssueForm');
  const popup = document.getElementById('popup');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      busNumber: document.getElementById('busNumber').value,
      issueType: document.getElementById('issueType').value,
      description: document.getElementById('description').value,
      timestamp: serverTimestamp()
    };

    try {
      await addDoc(collection(db, "bus_issues"), data);
      popup.classList.add('active');
      setTimeout(() => {
        popup.classList.remove('active');
        form.reset();
      }, 2500);
    } catch (error) {
      console.error("Error adding document:", error);
      alert("❌ Failed to submit report. Check Firebase rules or console.");
    }
  });
</script>

</body>
</html>
